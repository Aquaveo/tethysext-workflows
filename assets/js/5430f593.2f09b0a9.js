"use strict";(self.webpackChunkworkflows_extension=self.webpackChunkworkflows_extension||[]).push([[4242],{733:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"tutorial/tethys_settings","title":"Add Tethys Settings","description":"Start from Previous Solution","source":"@site/docs/tutorial/tethys_settings.md","sourceDirName":"tutorial","slug":"/tutorial/tethys_settings","permalink":"/tethysext-workflows/docs/tutorial/tethys_settings","draft":false,"unlisted":false,"editUrl":"https://github.com/Aquaveo/tethysext-workflows/edit/main/docs/docs/tutorial/tethys_settings.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"tethys_settings","title":"Add Tethys Settings","sidebar_label":"Add Tethys Settings","excerpt":"Add Tethys Settings to your app","sidebar_position":3},"sidebar":"documentationSidebar","previous":{"title":"App Setup","permalink":"/tethysext-workflows/docs/tutorial/app_setup"},"next":{"title":"Add Managers","permalink":"/tethysext-workflows/docs/tutorial/managers"}}');var r=s(4848),i=s(8453);const o={id:"tethys_settings",title:"Add Tethys Settings",sidebar_label:"Add Tethys Settings",excerpt:"Add Tethys Settings to your app",sidebar_position:3},a=void 0,l={},d=[{value:"Start from Previous Solution",id:"start-from-previous-solution",level:3},{value:"Add Settings",id:"add-settings",level:3},{value:"Condor Scheduler",id:"condor-scheduler",level:3},{value:"GeoServer",id:"geoserver",level:3},{value:"Persistent Store Service",id:"persistent-store-service",level:3},{value:"Assign Services",id:"assign-services",level:3},{value:"Solution",id:"solution",level:3}];function c(e){const t={a:"a",code:"code",h1:"h1",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h3,{id:"start-from-previous-solution",children:"Start from Previous Solution"}),"\n",(0,r.jsx)(t.p,{children:"If you wish to use the previous solution as a starting point:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"git clone https://github.com/Aquaveo/tethysapp-workflows_tutorial.git\ncd tethysapp-workflows_tutorial\ngit checkout -b new-app-setup-step new-app-setup-step-complete\n"})}),"\n",(0,r.jsx)(t.h3,{id:"add-settings",children:"Add Settings"}),"\n",(0,r.jsx)(t.p,{children:"Next, you'll need to add some settings to your Tethys app to enable things like database and geoserver connections."}),"\n",(0,r.jsxs)(t.p,{children:["Begin by adding these imports to the top of your ",(0,r.jsx)(t.code,{children:"app.py"})," file:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",metastring:'title="/tethysapp/workflows_tutorial/app.py"',children:"from tethys_sdk.app_settings import PersistentStoreDatabaseSetting, SpatialDatasetServiceSetting, SchedulerSetting\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Next, add the following code to your ",(0,r.jsx)(t.code,{children:"app.py"})," file in your App class:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",metastring:'title="/tethysapp/workflows_tutorial/app.py"',children:'class App(TethysAppBase):\n    ...\n    DATABASE_NAME = \'workflows_tutorial_db\'\n    SCHEDULER_NAME=\'primary_condor_scheduler\'\n    GEOSERVER_NAME=\'primary_geoserver\'\n\n\n    def persistent_store_settings(self):\n        """\n        Define persistent store settings.\n        """\n        ps_settings = (\n            PersistentStoreDatabaseSetting(\n                name=self.DATABASE_NAME,\n                description=\'database for app to use.\',\n                initializer=\'workflows_tutorial.model.init_db\',\n                required=True,\n                spatial=True\n            ),\n        )\n\n        return ps_settings\n    \n    def spatial_dataset_service_settings(self):\n        """\n        Define spatial dataset service settings.\n        """\n        sds_settings = (\n            SpatialDatasetServiceSetting(\n                name=self.GEOSERVER_NAME,\n                description=\'GeoServer service for app to use.\',\n                engine=SpatialDatasetServiceSetting.GEOSERVER,\n                required=True,\n            ),\n        )\n\n        return sds_settings\n    \n\n    def scheduler_settings(self):\n        """\n        Define scheduler settings\n        """\n        scheduler_settings = (\n            SchedulerSetting(\n                name=self.SCHEDULER_NAME,\n                description=\'Scheduler for HTCondor cluster.\',\n                engine=SchedulerSetting.HTCONDOR,\n                required=False,\n            ),\n        )\n\n        return scheduler_settings\n'})}),"\n",(0,r.jsx)(t.h1,{id:"setup-services",children:"Setup Services"}),"\n",(0,r.jsx)(t.h3,{id:"condor-scheduler",children:"Condor Scheduler"}),"\n",(0,r.jsx)(t.p,{children:"First, you'll need to set up your HTCondor Scheduler\nBegin by running this command to generate your condor SSH key"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"ssh-keygen -t rsa -b 4096 -f ~/.ssh/condor_key\n"})}),"\n",(0,r.jsx)(t.p,{children:"When prompted, provide your ssh key with a pass phrase, and make note of that pass phrase."}),"\n",(0,r.jsx)(t.p,{children:'Next, go into your tethys admin settings in your tethys portal and navigate to the HTCondor Schedulers page. Press "Add HTCondor Scheduler"'}),"\n",(0,r.jsx)(t.p,{children:"Name this service 'condor_scheduler', and assign the 'Host' field the value of 'localhost'."}),"\n",(0,r.jsx)(t.p,{children:"Update the username field to your username and the private key path to your personal condor_key file path, along with the private key pass that you provided when creating the key."}),"\n",(0,r.jsx)(t.p,{children:'Finally, press "Save".'}),"\n",(0,r.jsx)(t.h3,{id:"geoserver",children:"GeoServer"}),"\n",(0,r.jsx)(t.p,{children:"First, initialize your GeoServer docker container by running:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"    tethys docker init -c geoserver\n"})}),"\n",(0,r.jsx)(t.p,{children:"Now start up your container by running"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"    tethys docker start -c geoserver\n"})}),"\n",(0,r.jsx)(t.p,{children:'Now, go to the "Site Admin" settings and find the "Tethys Services" section. Select the "Spatial Dataset Services" link.\nCreate a new Spatial Dataset Service named "primary_geoserver" of type GeoServer'}),"\n",(0,r.jsxs)(t.p,{children:["Enter the endpoint and public endpoint as: ",(0,r.jsx)(t.a,{href:"http://localhost:8181/geoserver/rest/",children:"http://localhost:8181/geoserver/rest/"})," if you're using Docker, or if you're using a default installation of GeoServer, use:  ",(0,r.jsx)(t.a,{href:"http://localhost:8080/geoserver/rest/",children:"http://localhost:8080/geoserver/rest/"})]}),"\n",(0,r.jsx)(t.p,{children:'Fill out the username and password fields with "admin" as the username, and "geoserver" as the password'}),"\n",(0,r.jsx)(t.p,{children:'Press "Save".'}),"\n",(0,r.jsx)(t.h3,{id:"persistent-store-service",children:"Persistent Store Service"}),"\n",(0,r.jsx)(t.p,{children:'Return to Site Admin, and go to the "Tethys Services" section, and then select the "Persistent Store Services" link.\nClick "Add Persistent Store Service"'}),"\n",(0,r.jsx)(t.p,{children:'Give this new service the name "primary_db", with the following fields:'}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"'Host': localhost"}),"\n",(0,r.jsx)(t.li,{children:"'Port': 5432"}),"\n",(0,r.jsx)(t.li,{children:"'Username': tethys_super"}),"\n",(0,r.jsx)(t.li,{children:"'Password': pass"}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:'Press "Save"'}),"\n",(0,r.jsx)(t.h3,{id:"assign-services",children:"Assign Services"}),"\n",(0,r.jsx)(t.p,{children:"Finally, go to your tethys app settings and add the settings you just created."}),"\n",(0,r.jsx)(t.p,{children:"Start by finding the section labeled `Persistent Store Database Settings' and click on the drop down under 'Persistent Store Service' and select 'primary_db'"}),"\n",(0,r.jsx)(t.p,{children:"Next, go to the 'Spatial Dataset Service Settings' section, and select 'geoserver' in the dropdown."}),"\n",(0,r.jsx)(t.p,{children:"Lastly, move down to 'Scheduler Settings' and select 'condor_scheduler' in the dropdown."}),"\n",(0,r.jsx)(t.h3,{id:"solution",children:"Solution"}),"\n",(0,r.jsxs)(t.p,{children:["This concludes the Tethys Settings portion of the Tethys Workflows Extension Tutorial. You can view the solution on github at ",(0,r.jsx)(t.a,{href:"https://github.com/Aquaveo/tethysapp-workflows_tutorial",children:"https://github.com/Aquaveo/tethysapp-workflows_tutorial"})," or clone it as follows:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"git clone https://github.com/Aquaveo/tethysapp-workflows_tutorial.git\ncd tethysapp-workflows_tutorial\ngit checkout -b tethys-settings-step tethys-settings-step-complete\n"})})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>o,x:()=>a});var n=s(6540);const r={},i=n.createContext(r);function o(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);